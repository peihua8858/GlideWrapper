// Top-level build file where you can add configuration options common to all sub-projects/modules.
apply plugin: 'maven'
apply plugin: 'maven-publish'
def buildType = /*"SNAPSHOT"*/"release"
def mavenUrl = "http://10.32.2.200:8081/repository/globalegrow/"
def mavenUrlSnapshot = "http://10.32.2.200:8081/repository/globalegrow-snapshot/"
def mavenUserName = "longxl"
def mavenPwd = "longxl123"
def sdkVersionName = "1.0.5"
def sdkVersionNameSnapshot = "1.0.0-SNAPSHOT"
def pomName = "imageload"
def pomGroupId = "com.fz.imageloader"
def pomArtifactId = "imageloader"
def pomPackaging = "aar"
task androidJavadocs(type: Javadoc) {
    options.encoding = "utf-8"
    source = android.sourceSets.main.java.srcDirs
    //    failOnError false
    //添加cl
    // asspath，解析类型
    classpath += project.files(android.getBootClasspath().join(File.pathSeparator))
//    classpath += project.files(configurations.compile.files,android.getBootClasspath().join(File.pathSeparator))
}

//打包doc
task androidJavadocsJar(type: Jar, dependsOn: androidJavadocs) {
    classifier = 'javadoc' //分类器，区分jar
    from androidJavadocs.destinationDir
}

//打包源码
task androidSourcesJar(type: Jar) {
    classifier = 'sources'//分类器，区分jar
    from android.sourceSets.main.java.srcDirs
}
//解决 JavaDoc 中文注释生成失败的问题
tasks.withType(Javadoc) {
    options.addStringOption('Xdoclint:none', '-quiet')
    options.addStringOption('encoding', 'UTF-8')
    options.addStringOption('charSet', 'UTF-8')
//    options.addStringOption('doclet', 'com.google.doclava.Doclava')
//    options.addStringOption('docletpath', 'libs/doclava-1.0.5.jar')
}

artifacts {
    archives androidSourcesJar
    archives androidJavadocsJar
}
uploadArchives {
    repositories {
        mavenDeployer {
            println "start upload aar build type:" + buildType
            def ver = sdkVersionName
            if (buildType == "release") {
                println "uploadArchives build release"
                repository(url: mavenUrl) {
                    authentication(userName: mavenUserName, password: mavenPwd)
                }
                ver = sdkVersionName
            } else {
                println "uploadArchives build beta"
                snapshotRepository(url: mavenUrlSnapshot) {
                    authentication(userName: mavenUserName, password: mavenPwd)
                }
                ver = sdkVersionNameSnapshot
            }
            //pom必需的参数
            pom.project {
                name pomName
                description "update description"
                version ver
                artifactId pomArtifactId
                groupId pomGroupId
                packaging pomPackaging
            }
            doLast {
                println "upload aar success build type:" + buildType
            }
        }
    }
}